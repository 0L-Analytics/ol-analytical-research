-- Calculating liquid supply
with by_acc_type as (select 1 as ob, account_type, wallet_type, count(*) as cnt, round(sum(balance)/1000000) as balance from accountbalance group by account_type, wallet_type), sum_O as (select 2 as ob, 'LIQUID SUPPLY' as account_type, wallet_type, sum(cnt) as cnt, sum(balance) as balance from by_acc_type where wallet_type = 'O' group by wallet_type), sum_S as (select 3 as ob, 'SLOW SUPPLY' as account_type, wallet_type, sum(cnt) as cnt, sum(balance) as balance from by_acc_type where wallet_type = 'S' group by wallet_type) select ob, account_type, wallet_type, cnt, balance from by_acc_type UNION ALL select ob, account_type, wallet_type, cnt, balance from sum_o UNION ALL select ob, account_type, wallet_type, cnt, balance from sum_S order by 1, 5 desc;

